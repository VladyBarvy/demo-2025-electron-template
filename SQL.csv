CREATE TABLE roles (
    role_id SERIAL PRIMARY KEY,
    role_name VARCHAR(50) NOT NULL UNIQUE
);

CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    full_name VARCHAR(100) NOT NULL,
    login VARCHAR(100) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL, -- Пароль должен храниться в хэшированном виде
    role_id INTEGER NOT NULL REFERENCES roles(role_id) ON DELETE RESTRICT
);

CREATE TABLE suppliers (
    supplier_id SERIAL PRIMARY KEY,
    supplier_name VARCHAR(100) NOT NULL UNIQUE
);

CREATE TABLE manufacturers (
    manufacturer_id SERIAL PRIMARY KEY,
    manufacturer_name VARCHAR(100) NOT NULL UNIQUE
);

CREATE TABLE categories (
    category_id SERIAL PRIMARY KEY,
    category_name VARCHAR(50) NOT NULL UNIQUE
);

CREATE TABLE products (
    product_article VARCHAR(20) PRIMARY KEY,
    product_name VARCHAR(100) NOT NULL,
    unit_of_measure VARCHAR(10) NOT NULL DEFAULT 'шт.',
    price DECIMAL(10, 2) NOT NULL CHECK (price >= 0),
    current_discount INTEGER NOT NULL DEFAULT 0 CHECK (current_discount BETWEEN 0 AND 100),
    quantity_in_stock INTEGER NOT NULL DEFAULT 0 CHECK (quantity_in_stock >= 0),
    description TEXT,
    photo_url VARCHAR(255),
    supplier_id INTEGER NOT NULL REFERENCES suppliers(supplier_id) ON DELETE RESTRICT,
    manufacturer_id INTEGER NOT NULL REFERENCES manufacturers(manufacturer_id) ON DELETE RESTRICT,
    category_id INTEGER NOT NULL REFERENCES categories(category_id) ON DELETE RESTRICT
);

CREATE TABLE pickup_points (
    point_id SERIAL PRIMARY KEY,
    postal_code VARCHAR(10) NOT NULL,
    city VARCHAR(50) NOT NULL,
    street VARCHAR(100) NOT NULL,
    house_number VARCHAR(10) NOT NULL
);

CREATE TABLE order_statuses (
    status_id SERIAL PRIMARY KEY,
    status_name VARCHAR(50) NOT NULL UNIQUE
);

CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    order_date DATE NOT NULL,
    delivery_date DATE NOT NULL,
    pickup_code VARCHAR(20) NOT NULL,
    client_id INTEGER NOT NULL REFERENCES users(user_id) ON DELETE RESTRICT,
    point_id INTEGER NOT NULL REFERENCES pickup_points(point_id) ON DELETE RESTRICT,
    status_id INTEGER NOT NULL REFERENCES order_statuses(status_id) ON DELETE RESTRICT
);

CREATE TABLE order_items (
    order_item_id SERIAL PRIMARY KEY,
    order_id INTEGER NOT NULL REFERENCES orders(order_id) ON DELETE CASCADE,
    product_article VARCHAR(20) NOT NULL REFERENCES products(product_article) ON DELETE RESTRICT,
    quantity INTEGER NOT NULL CHECK (quantity > 0)
);





INSERT INTO roles (role_name) VALUES 
('Администратор'),
('Менеджер'),
('Авторизированный клиент');


INSERT INTO users (full_name, login, password_hash, role_id) VALUES 
('Никифорова Весения Николаевна', '94d5ous@gmail.com', 'uzWC67', 1),
('Сазонов Руслан Германович', 'uth4iz@mail.com', '2L6KZG', 1),
('Одинцов Серафим Артёмович', 'yzls62@outlook.com', 'JlFRCZ', 1),
('Степанов Михаил Артёмович', '1diph5e@tutanota.com', '8ntwUp', 2),
('Ворсин Петр Евгеньевич', 'tjde7c@yahoo.com', 'YOyhfR', 2),
('Старикова Елена Павловна', 'wpmrc3do@tutanota.com', 'RSbvHv', 2),
('Михайлюк Анна Вячеславовна', '5d4zbu@tutanota.com', 'rwVDh9', 3),
('Ситдикова Елена Анатольевна', 'ptec8ym@yahoo.com', 'LdNyos', 3),
('Ворсин Петр Евгеньевич', '1qz4kw@mail.com', 'gynQMT', 3),
('Старикова Елена Павловна', '4np6se@mail.com', 'AtnDjr', 3);




INSERT INTO suppliers (supplier_name) VALUES 
('Kari'),
('Обувь для вас');


INSERT INTO manufacturers (manufacturer_name) VALUES 
('Kari'),
('Marco Tozzi'),
('Рос'),
('Rieker'),
('Alessio Nesca'),
('CROSBY'),
('ARGO'),
('Luiza Belly'),
('TOFA'),
('ROMER'),
('Caprice');


INSERT INTO categories (category_name) VALUES 
('Женская обувь'),
('Мужская обувь');


INSERT INTO products (product_article, product_name, unit_of_measure, price, current_discount, quantity_in_stock, description, photo_url, supplier_id, manufacturer_id, category_id) VALUES 
('A112T4', 'Ботинки', 'шт.', 4990.00, 3, 6, 'Женские Ботинки демисезонные kari', '1.jpg', 1, 1, 1),
('F635R4', 'Ботинки', 'шт.', 3244.00, 2, 13, 'Ботинки Marco Tozzi женские демисезонные, размер 39, цвет бежевый', '2.jpg', 2, 2, 1),
('H782T5', 'Туфли', 'шт.', 4499.00, 4, 5, 'Туфли kari мужские классика MYZ21AW-450A, размер 43, цвет: черный', '3.jpg', 1, 1, 2),
('G783F5', 'Ботинки', 'шт.', 5900.00, 2, 8, 'Мужские ботинки Рос-Обувь кожаные с натуральным мехом', '4.jpg', 1, 3, 2),
('J384T6', 'Ботинки', 'шт.', 3800.00, 2, 16, 'B3430/14 Полуботинки мужские Rieker', '5.jpg', 2, 4, 2),
('D572U8', 'Кроссовки', 'шт.', 4100.00, 3, 6, '129615-4 Кроссовки мужские', '6.jpg', 2, 3, 2),
('F572H7', 'Туфли', 'шт.', 2700.00, 2, 14, 'Туфли Marco Tozzi женские летние, размер 39, цвет черный', '7.jpg', 1, 2, 1),
('D329H3', 'Полуботинки', 'шт.', 1890.00, 4, 4, 'Полуботинки Alessio Nesca женские 3-30797-47, размер 37, цвет: бордовый', '8.jpg', 2, 5, 1),
('B320R5', 'Туфли', 'шт.', 4300.00, 2, 6, 'Туфли Rieker женские демисезонные, размер 41, цвет коричневый', '9.jpg', 1, 4, 1),
('G432E4', 'Туфли', 'шт.', 2800.00, 3, 15, 'Туфли kari женские TR-YR-413017, размер 37, цвет: черный', '10.jpg', 1, 1, 1),
('S213E3', 'Полуботинки', 'шт.', 2156.00, 3, 6, '407700/01-01 Полуботинки мужские CROSBY', '11.jpg', 2, 6, 2),
('E482R4', 'Полуботинки', 'шт.', 1800.00, 2, 14, 'Полуботинки kari женские MYZ20S-149, размер 41, цвет: черный', '12.jpg', 1, 1, 1),
('S634B5', 'Кеды', 'шт.', 5500.00, 3, 6, 'Кеды Caprice мужские демисезонные, размер 42, цвет черный', '13.jpg', 2, 11, 2),
('K345R4', 'Полуботинки', 'шт.', 2100.00, 2, 3, '407700/01-02 Полуботинки мужские CROSBY', '14.jpg', 2, 6, 2),
('O754F4', 'Туфли', 'шт.', 5400.00, 4, 18, 'Туфли женские демисезонные Rieker артикул 55073-68/37', '15.jpg', 2, 4, 1),
('G531F4', 'Ботинки', 'шт.', 6600.00, 2, 9, 'Ботинки женские зимние ROMER арт. 893167-01 Черный', '16.jpg', 1, 10, 1),
('J542F5', 'Тапочки', 'шт.', 500.00, 3, 12, 'Тапочки мужские Арт.70701-55-67син р.41', '17.jpg', 1, 1, 2),
('B431R5', 'Ботинки', 'шт.', 2700.00, 2, 5, 'Мужские кожаные ботинки/мужские ботинки', '18.jpg', 2, 4, 2),
('P764G4', 'Туфли', 'шт.', 6800.00, 3, 15, 'Туфли женские, ARGO, размер 38', '19.jpg', 1, 7, 1),
('C436G5', 'Ботинки', 'шт.', 10200.00, 2, 9, 'Ботинки женские, ARGO, размер 40', '20.jpg', 1, 5, 1),
('F427R5', 'Ботинки', 'шт.', 11800.00, 4, 11, 'Ботинки на молнии с декоративной пряжкой FRAU', '21.jpg', 2, 4, 1),
('N457T5', 'Полуботинки', 'шт.', 4600.00, 3, 13, 'Полуботинки Ботинки черные зимние, мех', '22.jpg', 1, 6, 1),
('D364R4', 'Туфли', 'шт.', 12400.00, 2, 5, 'Туфли Luiza Belly женские Kate-lazo черные из натуральной замши', '23.jpg', 1, 8, 1),
('S326R5', 'Тапочки', 'шт.', 9900.00, 3, 15, 'Мужские кожаные тапочки "Профиль С.Дали"', '24.jpg', 2, 6, 2),
('L754R4', 'Полуботинки', 'шт.', 1700.00, 2, 7, 'Полуботинки kari женские WB2020SS-26, размер 38, цвет: черный', '25.jpg', 1, 1, 1),
('M542T5', 'Кроссовки', 'шт.', 2800.00, 5, 3, 'Кроссовки мужские TOFA', '26.jpg', 2, 9, 2),
('D268G5', 'Туфли', 'шт.', 4399.00, 3, 12, 'Туфли Rieker женские демисезонные, размер 36, цвет коричневый', '27.jpg', 2, 4, 1),
('T324F5', 'Сапоги', 'шт.', 4699.00, 2, 5, 'Сапоги замша Цвет: синий', '28.jpg', 1, 6, 1),
('K358H6', 'Тапочки', 'шт.', 599.00, 3, 2, 'Тапочки мужские син р.41', '29.jpg', 1, 4, 2),
('H535R5', 'Ботинки', 'шт.', 2300.00, 2, 7, 'Женские Ботинки демисезонные', '30.jpg', 2, 4, 1);










INSERT INTO pickup_points (postal_code, city, street, house_number) VALUES
('420151', 'Lesnoy', 'Vishnevaya', '32'),
('125061', 'Lesnoy', 'Podgornaya', '8'),
('630370', 'Lesnoy', 'Shosseynaya', '24'),
('400562', 'Lesnoy', 'Zelenaya', '32'),
('614510', 'Lesnoy', 'Mayakovskogo', '47'),
('410542', 'Lesnoy', 'Svetlaya', '46'),
('620839', 'Lesnoy', 'Tsvetochnaya', '8'),
('443890', 'Lesnoy', 'Kommunisticheskaya', '1'),
('603379', 'Lesnoy', 'Sportivnaya', '46'),
('603721', 'Lesnoy', 'Gogolya', '41'),
('410172', 'Lesnoy', 'Severnaya', '13'),
('614611', 'Lesnoy', 'Molodezhnaya', '50'),
('454311', 'Lesnoy', 'Novaya', '19'),
('660007', 'Lesnoy', 'Oktyabrskaya', '19'),
('603036', 'Lesnoy', 'Sadowaya', '4'),
('394060', 'Lesnoy', 'Frunze', '43'),
('410661', 'Lesnoy', 'Shkolnaya', '50'),
('625590', 'Lesnoy', 'Kommunisticheskaya', '20'),
('625683', 'Lesnoy', '8 Marta', '1'),
('450983', 'Lesnoy', 'Komsomolskaya', '26'),
('394782', 'Lesnoy', 'Chehova', '3'),
('603002', 'Lesnoy', 'Dzerzhinskogo', '28'),
('450558', 'Lesnoy', 'Naberezhnaya', '30'),
('344288', 'Lesnoy', 'Chehova', '1'),
('614164', 'Lesnoy', 'Stepnaya', '30'),
('394242', 'Lesnoy', 'Kommunisticheskaya', '43'),
('660540', 'Lesnoy', 'Solnachnaya', '25'),
('125837', 'Lesnoy', 'Shosseynaya', '40'),
('125703', 'Lesnoy', 'Partizanskaya', '49'),
('625283', 'Lesnoy', 'Pobedy', '46'),
('614753', 'Lesnoy', 'Polevaya', '35'),
('426030', 'Lesnoy', 'Mayakovskogo', '44'),
('450375', 'Lesnoy', 'Klubnaya', '44'),
('625560', 'Lesnoy', 'Nekrasova', '12'),
('630201', 'Lesnoy', 'Komsomolskaya', '17'),
('190949', 'Lesnoy', 'Michurina', '26');








INSERT INTO order_statuses (status_name) VALUES 
('New'),
('Completed');


INSERT INTO orders (order_id, order_date, delivery_date, pickup_code, client_id, point_id, status_id) VALUES 
(1, '2025-02-27', '2025-04-20', '901', 7, 1, 2),
(2, '2022-09-28', '2025-04-21', '902', 8, 11, 2), 
(3, '2025-03-21', '2025-04-22', '903', 9, 2, 2),
(4, '2025-02-20', '2025-04-23', '904', 10, 11, 2), 
(5, '2025-03-17', '2025-04-24', '905', 7, 2, 2),
(6, '2025-03-01', '2025-04-25', '906', 8, 15, 2),
(7, '2025-02-28', '2025-04-26', '907', 9, 3, 2), 
(8, '2025-03-31', '2025-04-27', '908', 10, 19, 1),
(9, '2025-04-02', '2025-04-28', '909', 7, 5, 1),
(10, '2025-04-03', '2025-04-29', '910', 7, 19, 1);


INSERT INTO order_items (order_id, product_article, quantity) VALUES
(1, 'A112T4', 2),
(1, 'F635R4', 2),
(2, 'H782T5', 1),
(2, 'G783F5', 1),
(3, 'J384T6', 10),
(3, 'D572U8', 10),
(4, 'F572H7', 5),
(4, 'D329H3', 4),
(5, 'A112T4', 2),
(5, 'F635R4', 2),
(6, 'H782T5', 1),
(6, 'G783F5', 1),
(7, 'J384T6', 10),
(7, 'D572U8', 10),
(8, 'F572H7', 5),
(8, 'D329H3', 4),
(9, 'B320R5', 5),
(9, 'G432E4', 1),
(10, 'S213E3', 5),
(10, 'E482R4', 5);
